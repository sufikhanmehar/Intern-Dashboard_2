<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Dashboard API</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 8px; max-width: 800px; margin: 0 auto; }
        .test { margin: 20px 0; padding: 15px; border-radius: 5px; border: 1px solid #ddd; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .loading { background: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; white-space: pre-wrap; }
        .url { font-family: monospace; background: #e9ecef; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Dashboard API Debug Tool</h1>
        
        <div class="test">
            <h3>Environment Information</h3>
            <p><strong>Current URL:</strong> <span class="url" id="currentUrl"></span></p>
            <p><strong>Hostname:</strong> <span class="url" id="hostname"></span></p>
            <p><strong>Protocol:</strong> <span class="url" id="protocol"></span></p>
            <p><strong>Detected API Base URL:</strong> <span class="url" id="apiBaseUrl"></span></p>
        </div>

        <div class="test">
            <h3>API Tests</h3>
            <button onclick="testHealthCheck()">üè• Test Health Check</button>
            <button onclick="testDashboardStats()">üìä Test Dashboard Stats</button>
            <button onclick="testInternsList()">üë• Test Interns List</button>
            <button onclick="runAllTests()">üöÄ Run All Tests</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // API Configuration (same as main app)
        const API_BASE_URL = (() => {
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                return 'http://localhost:3000/api';
            }
            return '/api';
        })();

        // Update environment info
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('hostname').textContent = window.location.hostname;
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('apiBaseUrl').textContent = API_BASE_URL;

        function addResult(title, status, message, data = null) {
            const results = document.getElementById('results');
            const result = document.createElement('div');
            result.className = `test ${status}`;
            
            let content = `<h4>${title}</h4><p>${message}</p>`;
            if (data) {
                content += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
            
            result.innerHTML = content;
            results.appendChild(result);
        }

        async function testHealthCheck() {
            addResult('üè• Health Check', 'loading', 'Testing health check endpoint...');
            
            try {
                const response = await fetch(`${API_BASE_URL.replace('/api', '')}/api/health`);
                const data = await response.json();
                
                if (response.ok) {
                    addResult('üè• Health Check', 'success', 
                        `‚úÖ Health check successful! Server is running.`, data);
                } else {
                    addResult('üè• Health Check', 'error', 
                        `‚ùå Health check failed with status ${response.status}`, data);
                }
            } catch (error) {
                addResult('üè• Health Check', 'error', 
                    `‚ùå Health check failed: ${error.message}`);
            }
        }

        async function testDashboardStats() {
            addResult('üìä Dashboard Stats', 'loading', 'Testing dashboard stats endpoint...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/dashboard/stats`);
                const data = await response.json();
                
                if (response.ok) {
                    addResult('üìä Dashboard Stats', 'success', 
                        `‚úÖ Dashboard stats loaded successfully!`, data);
                } else {
                    addResult('üìä Dashboard Stats', 'error', 
                        `‚ùå Dashboard stats failed with status ${response.status}`, data);
                }
            } catch (error) {
                addResult('üìä Dashboard Stats', 'error', 
                    `‚ùå Dashboard stats failed: ${error.message}`);
            }
        }

        async function testInternsList() {
            addResult('üë• Interns List', 'loading', 'Testing interns list endpoint...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/interns`);
                const data = await response.json();
                
                if (response.ok) {
                    const count = data.data ? data.data.length : 0;
                    addResult('üë• Interns List', 'success', 
                        `‚úÖ Interns list loaded successfully! Found ${count} interns.`, 
                        { count, pagination: data.pagination });
                } else {
                    addResult('üë• Interns List', 'error', 
                        `‚ùå Interns list failed with status ${response.status}`, data);
                }
            } catch (error) {
                addResult('üë• Interns List', 'error', 
                    `‚ùå Interns list failed: ${error.message}`);
            }
        }

        async function runAllTests() {
            // Clear previous results
            document.getElementById('results').innerHTML = '';
            
            // Run tests sequentially
            await testHealthCheck();
            await new Promise(resolve => setTimeout(resolve, 500)); // Small delay
            await testDashboardStats();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testInternsList();
            
            addResult('üéØ Summary', 'success', 
                'All tests completed! Check results above to identify any issues.');
        }

        // Auto-run health check on page load
        window.addEventListener('load', () => {
            setTimeout(testHealthCheck, 1000);
        });
    </script>
</body>
</html>